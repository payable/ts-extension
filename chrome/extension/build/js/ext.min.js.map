{"version":3,"file":"ext.min.js","sources":["common/dates.js","background/record.js","background/clickHandler.js","background/msgRouter.js","background/localStorage.js","background/state.js","background/listenContent.js","background/popupStartController.js","background/listenPopup.js","BackgroundMain.js"],"names":["define","Dates","prototype","weekdays","full","short","getFullDate","date","needSex","this","getHumanDate","getHumanTime","month","day","dateFormatted","Date","getTime","xx","getMonth","getDate","getFullYear","hours","mins","sex","getHours","getMinutes","getSeconds","value","parseInt","getDayName","d","getDay","dates","RecordMaker","make","details","endTime","startTime","textArr","queue","id","subject","setHours","setMinutes","unshift","join","copy","text","copyDiv","document","createElement","contentEditable","body","appendChild","innerHTML","unselectable","focus","execCommand","removeChild","record","onItemClick","info","tab","chrome","tabs","sendMessage","onGetDetails","bind","contextMenus","create","title","contexts","onclick","MessageRouter","actionPrefix","runtime","onMessage","addListener","messageListener","add","a","b","map","request","sender","sendResponse","action","err","console","warn","callback","Storage","ls","window","localStorage","setItem","name","item","skipStringify","JSON","stringify","error","getItem","skipParse","parse","msgRouter","State","started","tickets","init","__init","onMsgGetState","restoreState","getState","toggleDayStart","setState","startTicket","contentPageData","validateTicketData","ticket","t","push","state","n","Notification","icon","setTimeout","close","data","getTicketById","filter","makeRecord","recordString","apply","arguments","PopupStartController","onClick","popupStartController","require"],"mappings":"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CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpEA,ADqEA;ACpEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7CA,AD8CA;AC7CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClDA,ADmDA;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzHA,AD0HA;ACzHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA,ADoBA;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACTA,ADUA;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["/* global chrome */\n\ndefine('common/dates',[\n], function(){\n    function Dates(){\n    }\n    Dates.prototype.weekdays = {\n        full: [\n            'Sunday',\n            'Monday',\n            'Tuesday',\n            'Wednesday',\n            'Thursday',\n            'Friday',\n            'Saturday'\n        ],\n        short: [\n            'Sun',\n            'Mon',\n            'Tue',\n            'Wed',\n            'Thu',\n            'Fri',\n            'Sat'\n        ]\n    };\n    Dates.prototype.getFullDate = function (date, needSex) {\n        return this.getHumanDate(date) + ' ' + this.getHumanTime(date, needSex);\n    };\n\n    Dates.prototype.getHumanDate = function (date) {\n        var month, day, dateFormatted;\n        date = new Date(date.getTime());\n        month = this.xx( date.getMonth() + 1 );\n        day = this.xx( date.getDate() );\n        dateFormatted = date.getFullYear() + '-' + month + '-' + day;\n\n        return dateFormatted;\n    };\n\n    Dates.prototype.getHumanTime = function (date, needSex) {\n        var hours, mins, sex, dateFormatted;\n        hours = this.xx( date.getHours() );\n        mins = this.xx( date.getMinutes() );\n        sex = this.xx( date.getSeconds() ); // \"secs\" =)\n        dateFormatted = hours + ':' + mins + (needSex ? (':' + sex) : '');\n\n        return dateFormatted;\n    };\n    /**\n     * Two digits, '1' -> '01'\n     * @param {Number} value\n     * @returns {String}\n     */\n    Dates.prototype.xx = function (value) {\n        value = parseInt(value, 10);\n        return value < 10 ? '0' + value : (value + '');\n    };\n\n    Dates.prototype.getDayName = function(date, short){\n        var d = date || new Date();\n        return this.weekdays[short ? 'short' : 'full'][d.getDay()];\n    };\n    \n    return new Dates();\n\n});\n\n\n","define('background/record',[\n    'common/dates'\n], function(dates){\n    function RecordMaker(){\n    }\n\n    RecordMaker.prototype.make = function(details){\n        var dateFormatted, date, month, day, endTime, startTime, hours, mins;\n        var textArr = [details.queue, details.id, details.subject];\n\n        textArr[1] = 'RT:' + textArr[1];\n        textArr[2] = '\"' + textArr[2] + '\"';\n        date = new Date();\n        dateFormatted = dates.getHumanDate(date);\n\n        endTime = dates.getHumanTime(date);\n\n        date.setHours(10);\n        date.setMinutes(0);\n\n        startTime = dates.getHumanTime(date);\n\n        textArr.unshift(endTime);\n        textArr.unshift(startTime);\n        textArr.unshift(dateFormatted);\n\n        textArr = textArr.join(',');\n\n        this.copy(textArr);\n        return textArr;\n    };\n\n    RecordMaker.prototype.copy = function(text){\n        var copyDiv = document.createElement('div');\n        copyDiv.contentEditable = true;\n        document.body.appendChild(copyDiv);\n        copyDiv.innerHTML = text;\n        copyDiv.unselectable = \"off\";\n        copyDiv.focus();\n        document.execCommand('SelectAll');\n        document.execCommand(\"Copy\", false, null);\n        document.body.removeChild(copyDiv);\n    };\n\n    return new RecordMaker();\n});\n","/* global chrome */\n\ndefine('background/clickHandler',['background/record'], function (record) {\n    chrome.contextMenus.create(\n        {\n            title: 'Form TS rec and ctrl+C',\n            contexts: [\"page\", \"selection\"],\n            onclick: onItemClick\n        }\n    );\n\n    function onItemClick(info, tab) {\n        chrome.tabs.sendMessage(tab.id, {text: \"tsGetDetails\"}, onGetDetails.bind(this, info));\n    }\n\n    function onGetDetails(info, details) {\n        details = details || {};\n        record.make(details);\n    }\n});\n","/* global chrome */\n\ndefine('background/msgRouter',[\n], function(){\n    function MessageRouter(){\n        this.actionPrefix = 'ts_ext_';\n        chrome.runtime.onMessage.addListener(this.messageListener.bind(this));\n\n        this.add = function(a,b){\n            this[a] = b;\n        };\n    }\n\n    // one action - one callback\n    MessageRouter.prototype.map = {};\n\n    /**\n     * Function, which handles messages\n     * @param {Object} request POJO with required 'action' property\n     * @param {String} request.action\n     * @param {Object} sender Chrome tab\n     * @param {Function} sendResponse Call special function, which is waiting for an answer\n     * @returns {undefined}\n     */\n    MessageRouter.prototype.messageListener = function (request, sender, sendResponse) {\n        try{\n            var action = request.action;\n            if ( this.map[action] && typeof this.map[action] === 'function' ){\n                this.map[action](request, sender, sendResponse); // provide already bound functions if needed\n            }\n        }catch(err){\n            console.warn('Message processing has failed. Let the developer know about that.');\n        }\n    };\n\n    /**\n     * Add one association \"action->handler\", which is checked with every\n     * message came\n     * @param {String} action\n     * @param {Function} callback\n     * @returns {undefined}\n     */\n    MessageRouter.prototype.addListener = function (action, callback) {\n        this.map[this.actionPrefix + action] = callback; // one action - one callback\n    };\n\n    return new MessageRouter();\n\n});\n\n\n","/* global chrome */\n\ndefine('background/localStorage',[\n], function(){\n    var ls = window.localStorage;\n    // handles local storage\n    function Storage(){\n\n    }\n\n    Storage.prototype.setItem = function(name, item, skipStringify){\n        try{\n            ls.setItem(name, skipStringify ? item : JSON.stringify(item));\n        }catch(err){\n            console.error('setItem fails', err);\n            return false;\n        }\n        return true;\n    };\n\n    Storage.prototype.getItem = function(name, skipParse){\n        var item;\n        try{\n            item = ls.getItem(name);\n            item = skipParse ? item : JSON.parse(item);\n        }catch(err){\n            console.error('setItem fails', err);\n            return false;\n        }\n        return item;\n    };\n\n    return new Storage();\n\n});\n\n\n","/* global chrome */\n\ndefine('background/state',[\n    'background/msgRouter',\n    'background/localStorage'\n], function (msgRouter, ls) {\n    // handles clicks on 'start' popup button (it may change its caption)\n    function State() {\n\n    }\n    // d is for data\n    State.prototype.d = {\n        started: false,\n        tickets: []\n    };\n\n    State.prototype.init = function () {\n        if (!this.__init) {\n            msgRouter.addListener('getState', this.onMsgGetState.bind(this));\n            this.restoreState();\n            this.__init = true;\n        }\n        return this;\n    };\n\n    State.prototype.onMsgGetState = function (request, sender, sendResponse) {\n        sendResponse(this.getState());\n    };\n\n    /**\n     *\n     * @returns {Boolean} Current state after switch\n     */\n    State.prototype.toggleDayStart = function () {\n        var d = this.d;\n        if (d.started) {\n            d.started = false;\n            d.endTime = new Date().getTime();\n        } else {\n            d.started = true;\n            d.startTime = new Date().getTime();\n        }\n        this.setState();\n    };\n\n    State.prototype.startTicket = function (contentPageData) {\n        if (!this.validateTicketData(contentPageData)) {\n            return;\n        }\n        this.d.tickets = this.d.tickets || [];\n        var ticket, t;\n        t = contentPageData;\n\n\n        // we'll start with having only one active ticket\n        /*\n         ticket = this.getTicketById(t.id);\n         if (ticket){\n            ticket.started = new Date().getTime();\n         }else{\n         ticket = {\n            id: t.id,\n            subject: t.subject,\n            queue: t.queue,\n            started: new Date().getTime()\n         };\n         this.d.tickets.push(ticket);\n         }\n         */\n\n        // implementation of single-ticket approach\n        this.d.tickets = []; // drop everything\n        ticket = {\n            id: t.id,\n            subject: t.subject,\n            queue: t.queue,\n            started: new Date().getTime()\n        };\n        this.d.tickets.push(ticket);\n\n        this.setState();\n        chrome.runtime.sendMessage(\n            {action: 'ts_ext_updateState', state: this.d}\n        );\n        var n = new Notification('Ticket started', {\n            icon: 'img/icon48.png',\n            body: ticket.id + ': ' + ticket.subject\n        });\n        setTimeout(n.close.bind(n), 3000);\n        return ticket;\n    };\n\n    State.prototype.validateTicketData = function (data) {\n        return data.id && data.queue && data.subject;\n    };\n\n    State.prototype.getTicketById = function (id) {\n        this.d.tickets = this.d.tickets || [];\n        return this.d.tickets.filter(function (item) {\n            return item.id === id;\n        })[0];\n    };\n\n    State.prototype.restoreState = function () {\n        var state = this.getState();\n        if (!!state) {\n            this.d = state;\n        }\n    };\n\n    State.prototype.setState = function () {\n        ls.setItem('state', this.d);\n    };\n    State.prototype.getState = function () {\n        return ls.getItem('state');\n    };\n\n    return new State().init();\n\n});\n\n\n","/* global chrome */\n\ndefine('background/listenContent',[\n    'background/record',\n    'background/msgRouter',\n    'background/state'\n], function(record, msgRouter, state){\n    msgRouter.addListener('ticketDetails', makeRecord);\n    msgRouter.addListener('startTicket', startTicket);\n\n    function makeRecord(request, sender, sendResponse){\n        var recordString = record.make.apply(record, arguments);\n        sendResponse(recordString);\n    }\n\n    function startTicket(request, sender, sendResponse){\n        var ticket = state.startTicket(request);\n        sendResponse(ticket);\n    }\n});\n\n\n","/* global chrome */\n\ndefine('background/popupStartController',[\n    'background/state'\n], function(state){\n    // handles clicks on 'start' popup button (it may change its caption)\n    function PopupStartController(){\n\n    }\n\n    PopupStartController.prototype.onClick = function(request, sender, sendResponse){\n        state.toggleDayStart();\n        sendResponse(state.d);\n    };\n\n    return new PopupStartController();\n\n});\n\n\n","/* global chrome */\n\ndefine('background/listenPopup',[\n    'background/msgRouter',\n    'background/popupStartController'\n], function(msgRouter, popupStartController){\n    msgRouter.addListener('popupStartButton', popupStartController.onClick.bind(popupStartController));\n});\n\n\n","/**\n * This is the main JS file for background script, it is a subject to grunt's build routine.\n */\n\nrequire([\n    'background/clickHandler',\n    'background/listenContent',\n    'background/listenPopup'\n], function(){\n});\n\ndefine(\"BackgroundMain\", function(){});\n\n"]}